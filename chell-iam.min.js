"use strict";var httpAuthInterceptor=angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]);httpAuthInterceptor.factory("authService",["$rootScope","httpBuffer",function(a,b){return{wrongCredentials:!1,loginConfirmed:function(c,d){var e=d||function(a){return a};a.$broadcast("event:auth-loginConfirmed",c),b.retryAll(e)},loginCancelled:function(c,d){b.rejectAll(d),a.$broadcast("event:auth-loginCancelled",c)}}}]),httpAuthInterceptor.factory("authInterceptor",["$rootScope","$q","httpBuffer","$window",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},d.sessionStorage.token&&(a.headers.Authorization=d.sessionStorage.token),a},responseError:function(d){if(401===d.status&&!d.config.ignoreAuthModule){var e=b.defer();return c.append(d.config,e),a.$broadcast("event:auth-loginRequired",d),e.promise}return b.reject(d)}}}]),httpAuthInterceptor.config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]);var httpAuthInterceptorBuffer=angular.module("http-auth-interceptor-buffer",[]);httpAuthInterceptorBuffer.factory("httpBuffer",["$injector",function(a){function b(b,d){function e(a){d.resolve(a)}function f(a){d.reject(a)}c=c||a.get("$http"),c(b).then(e,f)}var c,d=[];return{append:function(a,b){d.push({config:a,deferred:b})},rejectAll:function(a){if(a)for(var b=0;b<d.length;++b)d[b].deferred.reject(a);d=[]},retryAll:function(a){for(var c=0;c<d.length;++c)b(a(d[c].config),d[c].deferred);d=[]}}}]);var chellIam=angular.module("chell-iam",["templates-chell-iam","ngTable","underscore","angular-underscore","http-auth-interceptor","ui.bootstrap","angular-md5","base64","ngMockE2E"]);chellIam.config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]),chellIam.run(["CurrentUserService","IamUser",function(a,b){a.authPromise=b.self().then(function(b){return a.setCurrentUser(b),b})}]),chellIam.filter("md5",["md5",function(a){return function(b){return a.createHash(b)}}]);var chellIam=angular.module("chell-iam");chellIam.factory("CurrentUserService",function(){return{authPromise:{},setCurrentUser:function(a){this.currentUser=a},getCurrentUser:function(){return this.currentUser},hasRoleId:function(a){return null==this.currentUser?!1:this.currentUser.primaryRole.id==a}}});var chellIam=angular.module("chell-iam");chellIam.factory("IamUser",["IamAdapter",function(a){return{query:function(){return a.getUserList()},get:function(b){return a.getUser(b)},self:function(){return a.getAuthenticatedUser()},create:function(b){return a.createUser(b)},update:function(b){return a.updateUser(b)},remove:function(b){return a.removeUser(b)}}}]),chellIam.factory("IamRole",["IamAdapter",function(a){return{query:function(){return a.getRoleList()},get:function(b){return a.getRole(b)},create:function(b){return a.createRole(b)},update:function(b){return a.updateRole(b)},remove:function(b){return a.removeRole(b)}}}]);var chellIam=angular.module("chell-iam");chellIam.directive("chellUserList",function(){return{restrict:"E",templateUrl:"templates/user-list.tpl.html"}}),chellIam.directive("chellRoleList",function(){return{restrict:"E",templateUrl:"templates/role-list.tpl.html"}}),chellIam.directive("chellUserProfile",function(){return{restrict:"E",transclude:!0,scope:{user:"=",roles:"="},templateUrl:"templates/user-profile.tpl.html"}}),chellIam.directive("chellLoginRequired",["$modal",function(a){return{restrict:"C",link:function(b){var c;b.$on("event:auth-loginRequired",function(){c||(c=a.open({templateUrl:"templates/login-dialog.tpl.html",backdrop:"static",keyboard:!1,windowClass:"login-dialog",controller:"AuthenticationController"}))}),b.$on("event:auth-logoutConfirmed",function(){c=a.open({templateUrl:"templates/login-dialog.tpl.html",backdrop:"static",keyboard:!1,windowClass:"login-dialog",controller:"AuthenticationController"})}),b.$on("event:auth-loginConfirmed",function(){c.close(),c=null})}}}]),chellIam.directive("chellLoginDialog",function(){return{restrict:"E",templateUrl:"templates/login-dialog.html"}}),chellIam.directive("visibilityRoleId",["CurrentUserService","IamUser",function(a,b){return{restrict:"A",controller:["$scope","$element",function(a,b){b.hide()}],link:function(c,d,e){b.self().then(function(){a.hasRoleId(e.visibilityRoleId)?d.show():d.hide()}),c.$on("event:auth-loginConfirmed",function(){b.self().then(function(){a.hasRoleId(e.visibilityRoleId)?d.show():d.hide()})}),c.$on("event:auth-logoutConfirmed",function(){d.hide()})}}}]),chellIam.directive("moveableRoleId",["CurrentUserService","IamUser",function(a,b){return{restrict:"A",controller:["$scope","$element",function(a,b){$(b).addClass("box-locked")}],link:function(c,d,e){b.self().then(function(){a.hasRoleId(e.moveableRoleId)?$(d).removeClass("box-locked"):$(d).addClass("box-locked")}),c.$on("event:auth-loginConfirmed",function(){b.self().then(function(){a.hasRoleId(e.moveableRoleId)?$(d).removeClass("box-locked"):$(d).addClass("box-locked")})}),c.$on("event:auth-logoutConfirmed",function(){$(d).addClass("box-locked")})}}}]),angular.module("ui.bootstrap.modal").directive("modalWindow",["$timeout",function(a){return{priority:1,link:function(b,c){a(function(){c.find("[autofocus]").focus()})}}}]);var chellIam=angular.module("chell-iam");chellIam.controller("UserListController",["$scope","$modal","IamUser","IamRole","ngTableParams",function(a,b,c,d,e){a.list=!0,a.detail=!1,a.users=[],a.editUser={},d.query().then(function(b){a.roles=b}),a.$watchCollection("users",function(){a.tableParams&&a.tableParams.reload()}),c.query().then(function(b){a.users=b,a.tableParams=new e({page:1,count:10},{total:a.users.length,getData:function(b,c){b.resolve(a.users.slice((c.page()-1)*c.count(),c.page()*c.count()))},$scope:{$data:{},$emit:function(){}}})}),a.view=function(c){a.modalInstance=b.open({templateUrl:"templates/user-view-dialog.tpl.html",backdrop:!1,controller:"UserViewModalController",windowClass:"modal-wide",resolve:{user:function(){return c}}})},a.create=function(){a.editUser={},a.showDetail()},a.edit=function(b){a.editUser=b,a.showDetail()},a.remove=function(b){confirm("Are you sure?")&&c.remove(b).then(function(){a.users.splice(a.users.indexOf(b),1)})},a.save=function(){var b=null==a.editUser.id;b?c.create(a.editUser).then(function(b){a.users.push(b)}):c.update(a.editUser).then(function(){}),a.cancel()},a.cancel=function(){a.editUser={},a.showList()},a.showList=function(){a.list=!0,a.detail=!1},a.showDetail=function(){a.list=!1,a.detail=!0}}]),chellIam.controller("RoleListController",["$scope","$timeout","$modal","IamRole","ngTableParams",function(a,b,c,d,e){a.list=!0,a.detail=!1,a.roles=[],a.editRole={},a.$watchCollection("roles",function(){a.tableParams&&a.tableParams.reload()}),d.query().then(function(b){a.roles=b,a.tableParams=new e({page:1,count:10},{total:a.roles.length,getData:function(b,c){b.resolve(a.roles.slice((c.page()-1)*c.count(),c.page()*c.count()))},$scope:{$data:{},$emit:function(){}}})}),a.view=function(b){a.modalInstance=c.open({templateUrl:"templates/role-view-dialog.tpl.html",backdrop:!1,controller:"RoleViewModalController",windowClass:"modal-wide",resolve:{role:function(){return b}}})},a.create=function(){a.editRole={},a.possibleParentRoles=a.roles.slice(0),a.showDetail()},a.edit=function(b){a.editRole=b,a.possibleParentRoles=a.roles.filter(function(b){return b!=a.editRole}),a.showDetail()},a.remove=function(b){confirm("Are you sure?")&&d.remove(b).then(function(){a.roles.splice(a.roles.indexOf(b),1)})},a.save=function(){var b=null==a.editRole.id;b?d.create(a.editRole).then(function(b){a.roles.push(b)}):d.update(a.editRole).then(function(){}),a.cancel()},a.cancel=function(){a.editRole={},a.showList()},a.showList=function(){a.list=!0,a.detail=!1},a.showDetail=function(){a.list=!1,a.detail=!0}}]),chellIam.controller("RoleViewModalController",["$scope","$modalInstance","role",function(a,b,c){a.role=c,a.cancel=function(){b.dismiss("cancel")}}]),chellIam.controller("UserViewModalController",["$scope","$modalInstance","user",function(a,b,c){a.user=c,a.cancel=function(){b.dismiss("cancel")}}]),chellIam.controller("AuthenticationController",["$scope","IamAdapter","authService","$base64","$http","$window",function(a,b,c,d,e,f){a.wrongCredentials=c.wrongCredentials,a.signin=function(){var b="Basic "+d.encode(a.login+":"+a.password);f.sessionStorage.token=b,c.wrongCredentials=!0;var e=function(a){return a.headers.Authorization=b,a};c.loginConfirmed(null,e)},a.$on("event:auth-logoutConfirmed",function(){c.wrongCredentials=!1})}]),chellIam.controller("CurrentUserController",["$scope","IamUser","$http","$rootScope","$window","CurrentUserService",function(a,b,c,d,e,f){f.authPromise.then(function(b){a.currentUser=b}),b.self().then(function(b){a.currentUser=b,f.setCurrentUser(b)}),a.$on("event:auth-loginConfirmed",function(){b.self().then(function(b){a.currentUser=b,f.setCurrentUser(b)})}),a.$on("event:auth-logoutConfirmed",function(){e.sessionStorage.token=null,a.currentUser=null,f.setCurrentUser(null)}),a.logout=function(){d.$broadcast("event:auth-logoutConfirmed")}}]),angular.module("templates-chell-iam",["templates/login-dialog.tpl.html","templates/role-list.tpl.html","templates/role-view-dialog.tpl.html","templates/user-list.tpl.html","templates/user-profile.tpl.html","templates/user-view-dialog.tpl.html"]),angular.module("templates/login-dialog.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/login-dialog.tpl.html",'<div class="panel panel-default">\n    <div class="panel-heading">\n        <span class="glyphicon glyphicon-lock"></span> Login\n        <div style="float:right; font-size: 80%; position: relative; top:4px"><a href="#">Forgot password?</a></div>\n    </div>\n    <div class="panel-body">\n        <form role="form">\n            <div class="alert alert-danger" ng-show="wrongCredentials">\n                <a class="close" data-dismiss="alert" href="#">×</a>Incorrect Username or Password!\n            </div>\n            <div class="form-group" ng-class="{\'has-error has-feedback\':wrongCredentials}">\n                <div class="col-sm-12">\n                    <div style="margin-bottom: 25px" class="input-group">\n                        <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>\n                        <input class="form-control" id="inputLogin" placeholder="Login" required ng-model="$parent.login" autofocus>\n                    </div>\n                </div>\n            </div>\n            <div class="form-group" ng-class="{\'has-error has-feedback\':wrongCredentials}">\n                <div class="col-sm-12">\n                    <div style="margin-bottom: 25px" class="input-group">\n                        <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>\n                        <input type="password" class="form-control" id="inputPassword" placeholder="Password" required\n                               ng-model="$parent.password">\n                    </div>\n                </div>\n            </div>\n            <div class="form-group">\n                <div class="col-sm-12">\n                    <div class="checkbox">\n                        <label>\n                            <input type="checkbox"/>\n                            Remember me\n                        </label>\n                    </div>\n                </div>\n            </div>\n            <div class="form-group last">\n                <div class="col-sm-12">\n                    <button type="submit" class="btn btn-success btn-sm" ng-click="signin()">\n                        Log in\n                    </button>\n                    <button type="reset" class="btn btn-default btn-sm">\n                        Reset\n                    </button>\n                </div>\n            </div>\n        </form>\n    </div>\n    <div class="panel-footer">\n        Not Registred? <a href="http://www.jquery2dotnet.com">Register here</a></div>\n</div>\n')}]),angular.module("templates/role-list.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/role-list.tpl.html",'<div ng-controller="RoleListController">\n    <div ng-show="list">\n        <button class="btn btn-primary btn-xs" ng-click="create()"><i style="padding-right: 10px" class="glyphicon glyphicon-lock"></i>Create Role</button>\n        <table ng-table="tableParams" cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="datatable">\n            <tbody>\n            <tr ng-repeat="role in $data">\n                <td data-title="\'Name\'">{{role.name}}</td>\n                <td data-title="\'Role ID\'">{{role.id}}</td>\n                <td data-title="\'Parent ID\'">{{role.parentId}}</td>\n                <td data-title="\'Actions\'" class="center">\n                    <div class="btn-group btn-group-sm">\n                        <a class="btn btn-default" rel="tooltip" title="View" ng-click="view(role)">\n                            <i class="glyphicon glyphicon-zoom-in icon-white"></i>\n                        </a>\n                        <a class="btn btn-default" rel="tooltip" title="Edit" ng-click="edit(role)">\n                            <i class="glyphicon glyphicon-edit icon-white"></i>\n                        </a>\n                        <a class="btn btn-default" rel="tooltip" title="Delete" ng-click="remove(role)">\n                            <i class="glyphicon glyphicon-trash icon-white"></i>\n                        </a>\n                    </div>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n    </div>\n    <div ng-show="detail">\n        <form id="roleDetail">\n            <fieldset>\n                <div class="form-group">\n                    <label for="inputRoleId">Role ID</label>\n                    <input class="form-control" id="inputRoleId" placeholder="Generated" readonly="true" ng-model="editRole.id">\n                </div>\n                <div class="form-group">\n                    <label for="inputRolename">Name</label>\n                    <input class="form-control" id="inputRolename" placeholder="Name" required="true" ng-model="editRole.name">\n                </div>\n                <div class="form-group">\n                    <label for="inputParentRole">Parent Role</label>\n                    <select class="form-control" id="inputParentRole" ng-model="editRole.parentId" ng-options="role.id as (role.name) for role in possibleParentRoles">\n                        <option value="">-- choose role --</option>\n                    </select>\n                </div>\n            </fieldset>\n            <button class="btn btn-primary" ng-click="save()">Save</button>\n            <button class="btn btn-default" ng-click="cancel()">Cancel</button>\n        </form>\n    </div>\n</div>')}]),angular.module("templates/role-view-dialog.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/role-view-dialog.tpl.html",'<div class="modal-header">\n    <button class="close" ng-click="cancel()">×</button>\n    <h3>Role: {{role.name}}</h3>\n</div>\n<div class="modal-body">\n    <form id="roleDetail">\n        <fieldset>\n            <div class="form-group">\n                <label for="inputRoleId">Role ID</label>\n                <input class="form-control" id="inputRoleId" placeholder="Generated" readonly="true" ng-model="role.id">\n            </div>\n            <div class="form-group">\n                <label for="inputRolename">Name</label>\n                <input class="form-control" id="inputRolename" placeholder="Name" readonly="true" ng-model="role.name">\n            </div>\n            <div class="form-group">\n                <label for="inputParentRole">Parent Role</label>\n                <input class="form-control" id="inputParentRole" placeholder="None" readonly="true" ng-model="role.parentId">\n            </div>\n        </fieldset>\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" ng-click="cancel()">Close</button>\n</div>\n\n')}]),angular.module("templates/user-list.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/user-list.tpl.html",'<div ng-controller="UserListController">\n    <div ng-show="list">\n        <button class="btn btn-primary btn-xs" ng-click="create()"><i style="padding-right: 10px" class="glyphicon glyphicon-user"></i>Create User</button>\n        <table ng-table="tableParams" cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="datatable">\n            <tbody>\n            <tr ng-repeat="user in $data">\n                <td data-title="\'Name\'">{{user.fullname}}</td>\n                <td data-title="\'Login\'">{{user.login}}</td>\n                <td data-title="\'Date registered\'" class="center">{{user.creationDate | date:\'dd.MM.yyyy\'}}</td>\n                <td data-title="\'E-Mail\'">{{user.email}}</td>\n                <td data-title="\'User ID\'" class="center">{{user.id}}</td>\n                <td data-title="\'Primary Role\'" class="center">{{user.primaryRole.name}}</td>\n                <td data-title="\'State\'" class="center">\n                    <span class="badge">{{user.status}}</span>\n                </td>\n                <td data-title="\'Actions\'" class="center">\n                    <div class="btn-group btn-group-sm">\n                        <button class="btn btn-default" title="View">\n                            <i class="glyphicon glyphicon-zoom-in icon-white" ng-click="view(user)"></i>\n                        </button>\n                        <button class="btn btn-default" title="Edit" ng-click="edit(user)">\n                            <i class="glyphicon glyphicon-edit icon-white"></i>\n                        </button>\n                        <button class="btn btn-default" title="Delete" ng-click="remove(user)">\n                            <i class="glyphicon glyphicon-trash icon-white"></i>\n                        </button>\n                    </div>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n    </div>\n    <div ng-show="detail">\n        <chell-user-profile user="editUser" roles="roles">\n            <button type="submit" class="btn btn-primary" ng-click="save()">Save</button>\n            <button class="btn btn-default" ng-click="cancel()">Cancel</button>\n        </chell-user-profile>\n    </div>\n</div>')}]),angular.module("templates/user-profile.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/user-profile.tpl.html",'<div class="row">\n    <div class="col-md-8">\n        <form id="userProfile">\n            <fieldset>\n                <div class="form-group">\n                    <label for="inputLogin">Login</label>\n                    <input class="form-control" id="inputLogin" placeholder="Login" readonly="true" ng-model="user.login">\n                </div>\n                <div class="form-group">\n                    <label for="inputUserId">User ID</label>\n                    <input class="form-control" id="inputUserId" placeholder="Generated" readonly="true" ng-model="user.id">\n                </div>\n                <div class="form-group">\n                    <label for="inputFirstname">Firstname</label>\n                    <input class="form-control" id="inputFirstname" placeholder="Name" required="true" ng-model="user.firstname">\n                </div>\n                <div class="form-group">\n                    <label for="inputLastname">Lastname</label>\n                    <input class="form-control" id="inputLastname" placeholder="Lastname" required="true" ng-model="user.lastname">\n                </div>\n                <div class="form-group">\n                    <label for="inputEMail">E-Mail</label>\n                    <input class="form-control" id="inputEMail" placeholder="E-Mail" type="email" ng-model="user.email">\n                </div>\n                <div class="form-group">\n                    <label for="inputEMail">Gravatar E-Mail</label>\n                    <input class="form-control" id="inputGravatarMail" placeholder="Gravatar E-Mail" type="email" ng-model="user.gravatarMail">\n                </div>\n                <div class="form-group">\n                    <label for="inputPrimaryRole">Primary Role</label>\n                    <select class="form-control" id="inputPrimaryRole" ng-model="user.primaryRole" ng-options="role as (role.name) for role in roles">\n                        <option value="">-- choose role --</option>\n                    </select>\n                </div>\n                <div class="form-group">\n                    <label for="inputStatus">Status</label>\n                    <select class="form-control" id="inputStatus" ng-model="user.status">\n                        <option>active</option>\n                        <option>inactive</option>\n                    </select>\n                </div>\n            </fieldset>\n            <div ng-transclude></div>\n        </form>\n    </div>\n    <div class="col-md-4">\n        <div style="max-width: 220px; margin: 15px 5px">\n            <label>Profile Preview</label>\n            <img height="220" width="220" ng-src="{{user.gravatarMail ? (\'http://www.gravatar.com/avatar/\'+(user.gravatarMail | md5)+\'?s=220\') : user.photo}}">\n            <h1>\n                <span style="color: #333; font-size: 26px; line-height: 30px;">{{currentUser.fullname}}</span>\n                        <span style="display: block; overflow: hidden; width: 100%; font-size: 20px; font-style: normal; font-weight: 300;\n                        line-height: 24px; color: #666; text-overflow: ellipsis;">{{currentUser.login}}</span>\n            </h1>\n            <ul style="list-style: none; padding-left: 0px; padding-top: 15px; padding-bottom: 15px; border-top: 1px solid #428bca; border-bottom: 1px solid #428bca">\n                <li style="color: #428bca;"><i style="padding-right: 10px" class="glyphicon glyphicon-lock"></i>  {{user.primaryRole.name}}</li>\n                <li style="color: #428bca;"><i style="padding-right: 10px" class="glyphicon glyphicon-envelope"></i>  {{user.email}}</li>\n                <li style="color: #428bca;"><i style="padding-right: 10px" class="glyphicon glyphicon-time"></i>  {{user.creationDate | date:\'dd.MM.yyyy\'}}</li>\n                <li style="color: #428bca;"><i style="padding-right: 10px" class="glyphicon glyphicon-flag"></i>  {{user.status}}</li>\n            </ul>\n        </div>\n    </div>\n</div>')}]),angular.module("templates/user-view-dialog.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/user-view-dialog.tpl.html",'<div class="modal-header">\n    <button class="close" ng-click="cancel()">×</button>\n    <h3>User: {{user.fullname}}</h3>\n</div>\n<div class="modal-body">\n    <chell-user-profile user="user"/>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" ng-click="cancel()">Close</button>\n</div>\n\n')}]);